var O=Object.defineProperty;var U=(a,t,r)=>t in a?O(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r;var _=(a,t,r)=>U(a,typeof t!="symbol"?t+"":t,r);import{c as I,R as B,j as e,B as w,r as l,d as M,D as X}from"./index-DpfqfBid.js";import{L}from"./Layout-By0aFUYJ.js";import{C as k,a as E,b as D,e as Z,c as R}from"./index-1NCKpGgW.js";import{C as $}from"./circle-alert-D7E0CW1m.js";import{R as J}from"./refresh-cw-B1a_Gnsv.js";import{L as V}from"./label-DTj3kehB.js";import{S as Q,a as W,b as Y,c as ee,d as F}from"./select-BVKyTfy9.js";import{C as H,D as A}from"./DateInput-BfeOfL5n.js";import{F as se}from"./filter-CFiBjPYB.js";import{T as te,a as re,b as S,c as p,d as ae,e as h}from"./table-DchqUOMA.js";import{g as ne}from"./assetService-CKPmYJn_.js";import{f as C}from"./format-CaiECi-v.js";import"./addDays-ggkpGDyJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=I("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=I("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);class le extends B.Component{constructor(r){super(r);_(this,"resetError",()=>{this.setState({hasError:!1,error:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,n){console.error("ErrorBoundary caught an error:",r,n)}render(){if(this.state.hasError){if(this.props.fallback){const r=this.props.fallback;return e.jsx(r,{error:this.state.error,resetError:this.resetError})}return e.jsx("div",{className:"flex items-center justify-center min-h-96 p-4",children:e.jsxs(k,{className:"w-full max-w-md",children:[e.jsxs(E,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx($,{className:"w-12 h-12 text-red-500"})}),e.jsx(D,{className:"text-red-600",children:"Đã xảy ra lỗi"}),e.jsx(Z,{children:"Ứng dụng gặp sự cố không mong muốn. Vui lòng thử lại."})]}),e.jsx(R,{className:"text-center",children:e.jsxs(w,{onClick:this.resetError,className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Thử lại"]})})]})})}return this.props.children}}const P=B.memo(()=>e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-green-100 rounded-full",children:e.jsx(ie,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Báo cáo tài sản đã mượn"}),e.jsx("p",{className:"text-gray-600",children:"TS cần cắt bìa kiểm tra hàng quý"})]})]})}));P.displayName="BorrowReportHeader";const G=B.memo(({dateRange:a,setDateRange:t,selectedRoom:r,setSelectedRoom:n,rooms:c})=>{const g=l.useCallback(i=>{t(o=>({...o,start:i}))},[t]),s=l.useCallback(i=>{t(o=>({...o,end:i}))},[t]);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(k,{children:[e.jsx(E,{children:e.jsxs(D,{className:"flex items-center",children:[e.jsx(se,{className:"w-5 h-5 mr-2 text-green-600"}),"Bộ lọc thời gian"]})}),e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(V,{className:"text-sm font-medium text-gray-700 mb-2 block",children:[e.jsx(H,{className:"w-4 h-4 inline mr-1"}),"Từ ngày"]}),e.jsx(A,{value:a.start,onChange:g,placeholder:"Chọn ngày bắt đầu"})]}),e.jsxs("div",{children:[e.jsxs(V,{className:"text-sm font-medium text-gray-700 mb-2 block",children:[e.jsx(H,{className:"w-4 h-4 inline mr-1"}),"Đến ngày"]}),e.jsx(A,{value:a.end,onChange:s,placeholder:"Chọn ngày kết thúc"})]})]})})]}),e.jsxs(k,{children:[e.jsx(E,{children:e.jsxs(D,{className:"flex items-center",children:[e.jsx(ce,{className:"w-5 h-5 mr-2 text-green-600"}),"Hiển thị danh sách theo từng phòng"]})}),e.jsx(R,{children:e.jsxs(Q,{value:r,onValueChange:n,children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"Chọn phòng..."})}),e.jsxs(ee,{children:[e.jsx(F,{value:"all",children:"Tất cả các phòng"}),c.map(i=>e.jsx(F,{value:i,children:i},i))]})]})})]})]})});G.displayName="BorrowReportFilters";const oe=({transactions:a,currentPage:t,setCurrentPage:r,totalPages:n,ITEMS_PER_PAGE:c,totalRecords:g})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(re,{children:e.jsxs(S,{children:[e.jsx(p,{children:"Mã NV"}),e.jsx(p,{children:"Ngày GD"}),e.jsx(p,{children:"Ca"}),e.jsx(p,{children:"Phòng"}),e.jsx(p,{children:"Loại GD"}),e.jsx(p,{children:"Năm TS"}),e.jsx(p,{children:"Mã TS"}),e.jsx(p,{children:"Ghi chú"})]})}),e.jsx(ae,{children:a.length>0?a.map(s=>e.jsxs(S,{children:[e.jsx(h,{children:s.staff_code}),e.jsx(h,{children:s.transaction_date}),e.jsx(h,{children:s.parts_day}),e.jsx(h,{children:s.room}),e.jsx(h,{children:s.transaction_type}),e.jsx(h,{children:s.asset_year}),e.jsx(h,{children:s.asset_code}),e.jsx(h,{children:s.note})]},s.id)):e.jsx(S,{children:e.jsx(h,{colSpan:8,className:"text-center",children:"Không có dữ liệu giao dịch."})})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(w,{onClick:()=>r(s=>Math.max(1,s-1)),disabled:t===1,children:"Trước"}),e.jsxs("span",{children:["Trang ",t," / ",n," (Tổng: ",g," bản ghi)"]}),e.jsx(w,{onClick:()=>r(s=>Math.min(n,s+1)),disabled:t===n||n===0,children:"Tiếp"})]})]}),de=()=>{const[a,t]=l.useState([]),[r,n]=l.useState(!0),[c,g]=l.useState({start:C(new Date,"yyyy-MM-dd"),end:C(new Date,"yyyy-MM-dd")}),[s,i]=l.useState("all"),[o,N]=l.useState(1),y=10;l.useEffect(()=>{(async()=>{n(!0);try{const x=(await ne()).filter(j=>j.transaction_type==="Mượn TS");t(x)}catch(f){console.error("Error fetching borrow report data:",f),M.error("Không thể tải dữ liệu báo cáo mượn tài sản.")}finally{n(!1)}})()},[]);const m=l.useMemo(()=>a.filter(d=>{const f=new Date(d.transaction_date),x=c.start?new Date(c.start):null,j=c.end?new Date(c.end):null;x&&x.setHours(0,0,0,0),j&&j.setHours(23,59,59,999);const u=(!x||f>=x)&&(!j||f<=j),T=s==="all"||d.room===s;return u&&T}),[a,c,s]),v=l.useMemo(()=>{const d=(o-1)*y;return m.slice(d,d+y)},[m,o]),q=Math.ceil(m.length/y),K=l.useMemo(()=>[...new Set(a.map(d=>d.room))].sort(),[a]);return{isLoading:r,dateRange:c,setDateRange:g,selectedRoom:s,setSelectedRoom:i,currentPage:o,setCurrentPage:N,filteredTransactions:m,paginatedTransactions:v,totalPages:q,rooms:K,ITEMS_PER_PAGE:y,exportToCSV:()=>{if(m.length===0){M.warning("Không có dữ liệu để xuất.");return}const f=[["STT","Phòng","Năm TS","Mã TS","Loại","Ngày","CB"].join(","),...m.map((b,z)=>[z+1,b.room,b.asset_year,b.asset_code,b.transaction_type,C(new Date(b.transaction_date),"dd/MM/yyyy"),b.staff_code].join(","))].join(`
`),x="\uFEFF",j=new Blob([x+f],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a"),T=URL.createObjectURL(j);u.setAttribute("href",T),u.setAttribute("download",`BaoCaoTaiSanDaMuon_${C(new Date,"yyyyMMdd")}.csv`),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),M.success("Xuất file Excel thành công!")}}},Me=()=>{const{isLoading:a,dateRange:t,setDateRange:r,selectedRoom:n,setSelectedRoom:c,currentPage:g,setCurrentPage:s,filteredTransactions:i,paginatedTransactions:o,totalPages:N,rooms:y,ITEMS_PER_PAGE:m,exportToCSV:v}=de();return a?e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})}):e.jsx(L,{children:e.jsxs(le,{children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx(P,{}),e.jsx(G,{dateRange:t,setDateRange:r,selectedRoom:n,setSelectedRoom:c,rooms:y}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(w,{onClick:v,variant:"outline",className:"bg-green-500 text-white hover:bg-green-600",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Xuất Excel"]})}),e.jsx(oe,{transactions:o,currentPage:g,setCurrentPage:s,totalPages:N,ITEMS_PER_PAGE:m,totalRecords:i.length})]}),e.jsx("style",{children:`
          @media print {
            body * {
              visibility: hidden;
            }
            #print-section, #print-section * {
              visibility: visible;
            }
            #print-section {
              position: absolute;
              left: 0;
              top: 0;
              width: 100%;
            }
          }
        `})]})})};export{Me as default};
