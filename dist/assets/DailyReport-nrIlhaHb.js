import{c as H,r as c,d as fe,j as e,e as G,f as W,B as w,D as ye}from"./index-Cfyb-cTT.js";import{u as je,c as K,a as ve,b as be,d as U,R as Re,I as Te,e as P,P as De,f as Ne,C as _e,L as B}from"./Layout-Bu6kW370.js";import{g as ke}from"./assetService-DnP0953v.js";import{f as _,a as Se,b as we,c as Ce,d as Fe}from"./dateUtils-GKxu_fIk.js";import{d as F,C as L,a as A,b as q,c as O}from"./index-lOgDGn8a.js";import{L as T}from"./label-KRVLd3Sf.js";import{u as Ee,S as Me,a as Ie,b as Pe,c as Ge,d as I}from"./select-CdJOJDrA.js";import{D as V}from"./DateInput-DswrObUo.js";import{F as Le}from"./filter-CxtjQ7v6.js";import{T as Q,a as Y,b as k,c as R,d as z,e as y}from"./table-B3C0REyg.js";import"./format-CaiECi-v.js";import"./addDays-ggkpGDyJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=H("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=H("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),Oe=n=>{if(!n||n.length===0)return[];const a={};n.forEach(t=>{a[t.room]||(a[t.room]={}),a[t.room][t.asset_year]||(a[t.room][t.asset_year]=[]),a[t.room][t.asset_year].push(t.asset_code)});const s=new Map;n.forEach(t=>{const o=`${t.room}-${t.asset_year}-${t.asset_code}`;s.set(o,(s.get(o)||0)+1)});const i=[];for(const t of Object.keys(a).sort())for(const o of Object.keys(a[t]).sort()){const l=[...new Set(a[t][o])].sort((d,h)=>d-h).map(d=>{const h=`${t}-${o}-${d}`;return s.get(h)>1?`${d}*`:d.toString()});i.push({room:t,year:o,codes:l.join(", ")})}return i},$e=({filterType:n,dateStrings:a,customFilters:s})=>{switch(n){case"qln_pgd_next_day":return`QLN Sáng & PGD trong ngày (${a.morningTargetFormatted})`;case"morning":return`Sáng ngày (${a.morningTargetFormatted})`;case"afternoon":return`Chiều ngày (${a.nextWorkingDayFormatted})`;case"today":return`Trong ngày hôm nay (${a.todayFormatted})`;case"next_day":return`Trong ngày kế tiếp (${a.nextWorkingDayFormatted})`;case"custom":return s.start&&s.end?`Từ ${_(new Date(s.start))} đến ${_(new Date(s.end))}`:"Tùy chọn khoảng thời gian";default:return""}},Be=()=>{const[n,a]=c.useState(!1),[s,i]=c.useState(!0),[t,o]=c.useState("qln_pgd_next_day"),[r,l]=c.useState({start:"",end:"",parts_day:"all"}),[d,h]=c.useState(1),f=c.useRef(null),g=10,[m]=c.useState(()=>Se()),[u]=c.useState(()=>we()),[p]=c.useState(()=>Ce(m)),[j]=c.useState(()=>Fe()),v=c.useMemo(()=>({todayFormatted:_(m),morningTargetFormatted:_(u),nextWorkingDayFormatted:_(p)}),[m,u,p]),N=c.useMemo(()=>{const x={},S=m.toISOString().split("T")[0],M=u.toISOString().split("T")[0],C=p.toISOString().split("T")[0];if(t==="custom")if(r.start&&r.end)x.startDate=r.start,x.endDate=r.end,x.parts_day=r.parts_day;else return{};else switch(t){case"qln_pgd_next_day":x.isQlnPgdNextDay=!0,x.startDate=M;break;case"morning":x.startDate=M,x.endDate=M,x.parts_day="Sáng";break;case"afternoon":x.startDate=C,x.endDate=C,x.parts_day="Chiều";break;case"today":x.startDate=S,x.endDate=S;break;case"next_day":x.startDate=C,x.endDate=C;break;default:return{}}return x},[t,r,m,u,p]);c.useEffect(()=>{l({start:m.toISOString().split("T")[0],end:j.toISOString().split("T")[0],parts_day:"all"})},[m,j]);const{data:b=[],isLoading:xe}=je({queryKey:["assetTransactions",N],queryFn:()=>ke(N),enabled:!!N.startDate,staleTime:5*60*1e3});c.useEffect(()=>{h(1)},[b]),c.useEffect(()=>{window.innerWidth<768&&b.length>0&&f.current&&setTimeout(()=>{var S;(S=f.current)==null||S.scrollIntoView({behavior:"smooth",block:"start"})},300)},[b]);const he=()=>{r.start&&r.end?o("custom"):fe.warning("Vui lòng chọn cả ngày bắt đầu và ngày kết thúc.")},me=c.useMemo(()=>Oe(b),[b]),pe=c.useMemo(()=>{const x=(d-1)*g;return b.slice(x,x+g)},[b,d]),ge=Math.ceil(b.length/g);return{transactions:b,isLoading:xe,isExporting:n,showGrouped:s,setShowGrouped:i,filterType:t,setFilterType:o,customFilters:r,setCustomFilters:l,currentPage:d,setCurrentPage:h,resultsRef:f,handleCustomFilter:he,groupedRows:me,paginatedTransactions:pe,totalPages:ge,exportToPDF:()=>{a(!0),setTimeout(()=>{window.print(),a(!1)},500)},getFilterDisplayText:()=>$e({filterType:t,dateStrings:v,customFilters:r}),dateStrings:v}};var $="Radio",[Ve,X]=U($),[He,We]=Ve($),Z=c.forwardRef((n,a)=>{const{__scopeRadio:s,name:i,checked:t=!1,required:o,disabled:r,value:l="on",onCheck:d,form:h,...f}=n,[g,m]=c.useState(null),u=G(a,v=>m(v)),p=c.useRef(!1),j=g?h||!!g.closest("form"):!0;return e.jsxs(He,{scope:s,checked:t,disabled:r,children:[e.jsx(F.button,{type:"button",role:"radio","aria-checked":t,"data-state":se(t),"data-disabled":r?"":void 0,disabled:r,value:l,...f,ref:u,onClick:P(n.onClick,v=>{t||d==null||d(),j&&(p.current=v.isPropagationStopped(),p.current||v.stopPropagation())})}),j&&e.jsx(te,{control:g,bubbles:!p.current,name:i,value:l,checked:t,required:o,disabled:r,form:h,style:{transform:"translateX(-100%)"}})]})});Z.displayName=$;var J="RadioIndicator",ee=c.forwardRef((n,a)=>{const{__scopeRadio:s,forceMount:i,...t}=n,o=We(J,s);return e.jsx(De,{present:i||o.checked,children:e.jsx(F.span,{"data-state":se(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:a})})});ee.displayName=J;var Ke="RadioBubbleInput",te=c.forwardRef(({__scopeRadio:n,control:a,checked:s,bubbles:i=!0,...t},o)=>{const r=c.useRef(null),l=G(r,o),d=Ee(s),h=Ne(a);return c.useEffect(()=>{const f=r.current;if(!f)return;const g=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(g,"checked").set;if(d!==s&&u){const p=new Event("click",{bubbles:i});u.call(f,s),f.dispatchEvent(p)}},[d,s,i]),e.jsx(F.input,{type:"radio","aria-hidden":!0,defaultChecked:s,...t,tabIndex:-1,ref:l,style:{...t.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});te.displayName=Ke;function se(n){return n?"checked":"unchecked"}var Ue=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],E="RadioGroup",[Qe,gt]=U(E,[K,X]),re=K(),ae=X(),[Ye,ze]=Qe(E),ne=c.forwardRef((n,a)=>{const{__scopeRadioGroup:s,name:i,defaultValue:t,value:o,required:r=!1,disabled:l=!1,orientation:d,dir:h,loop:f=!0,onValueChange:g,...m}=n,u=re(s),p=ve(h),[j,v]=be({prop:o,defaultProp:t??null,onChange:g,caller:E});return e.jsx(Ye,{scope:s,name:i,required:r,disabled:l,value:j,onValueChange:v,children:e.jsx(Re,{asChild:!0,...u,orientation:d,dir:p,loop:f,children:e.jsx(F.div,{role:"radiogroup","aria-required":r,"aria-orientation":d,"data-disabled":l?"":void 0,dir:p,...m,ref:a})})})});ne.displayName=E;var oe="RadioGroupItem",ie=c.forwardRef((n,a)=>{const{__scopeRadioGroup:s,disabled:i,...t}=n,o=ze(oe,s),r=o.disabled||i,l=re(s),d=ae(s),h=c.useRef(null),f=G(a,h),g=o.value===t.value,m=c.useRef(!1);return c.useEffect(()=>{const u=j=>{Ue.includes(j.key)&&(m.current=!0)},p=()=>m.current=!1;return document.addEventListener("keydown",u),document.addEventListener("keyup",p),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",p)}},[]),e.jsx(Te,{asChild:!0,...l,focusable:!r,active:g,children:e.jsx(Z,{disabled:r,required:o.required,checked:g,...d,...t,name:o.name,ref:f,onCheck:()=>o.onValueChange(t.value),onKeyDown:P(u=>{u.key==="Enter"&&u.preventDefault()}),onFocus:P(t.onFocus,()=>{var u;m.current&&((u=h.current)==null||u.click())})})})});ie.displayName=oe;var Xe="RadioGroupIndicator",ce=c.forwardRef((n,a)=>{const{__scopeRadioGroup:s,...i}=n,t=ae(s);return e.jsx(ee,{...t,...i,ref:a})});ce.displayName=Xe;var de=ne,le=ie,Ze=ce;const ue=c.forwardRef(({className:n,...a},s)=>e.jsx(de,{className:W("grid gap-2",n),...a,ref:s}));ue.displayName=de.displayName;const D=c.forwardRef(({className:n,...a},s)=>e.jsx(le,{ref:s,className:W("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...a,children:e.jsx(Ze,{className:"flex items-center justify-center",children:e.jsx(_e,{className:"h-2.5 w-2.5 fill-current text-current"})})}));D.displayName=le.displayName;const Je=({filterType:n,setFilterType:a,customFilters:s,setCustomFilters:i,handleCustomFilter:t,dateStrings:o})=>e.jsxs(L,{children:[e.jsx(A,{children:e.jsxs(q,{className:"flex items-center",children:[e.jsx(Le,{className:"w-5 h-5 mr-2 text-green-600"}),"Bộ lọc danh sách cần xem:"]})}),e.jsxs(O,{children:[e.jsxs(ue,{value:n,onValueChange:a,className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"morning",id:"morning"}),e.jsxs(T,{htmlFor:"morning",children:["Sáng ngày (",o.morningTargetFormatted,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"qln_pgd_next_day",id:"qln_pgd_next_day"}),e.jsxs(T,{htmlFor:"qln_pgd_next_day",children:["QLN Sáng & PGD trong ngày (",o.morningTargetFormatted,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"afternoon",id:"afternoon"}),e.jsxs(T,{htmlFor:"afternoon",children:["Chiều ngày (",o.nextWorkingDayFormatted,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"today",id:"today"}),e.jsxs(T,{htmlFor:"today",children:["Trong ngày hôm nay (",o.todayFormatted,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"next_day",id:"next_day"}),e.jsxs(T,{htmlFor:"next_day",children:["Trong ngày kế tiếp (",o.nextWorkingDayFormatted,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"custom",id:"custom"}),e.jsx(T,{htmlFor:"custom",children:"Tùy chọn khoảng thời gian"})]})]}),n==="custom"&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Chọn buổi"}),e.jsxs(Me,{value:s.parts_day,onValueChange:r=>i(l=>({...l,parts_day:r})),children:[e.jsx(Ie,{children:e.jsx(Pe,{placeholder:"Chọn buổi"})}),e.jsxs(Ge,{children:[e.jsx(I,{value:"all",children:"Tất cả"}),e.jsx(I,{value:"Sáng",children:"Sáng"}),e.jsx(I,{value:"Chiều",children:"Chiều"})]})]})]}),e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Từ ngày"}),e.jsx(V,{value:s.start,onChange:r=>i(l=>({...l,start:r}))})]}),e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Đến ngày"}),e.jsx(V,{value:s.end,onChange:r=>i(l=>({...l,end:r}))})]}),e.jsx(w,{onClick:t,children:"Lọc"})]})]})]}),et=({groupedRows:n,filterDisplayText:a})=>e.jsxs(L,{className:"rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsxs(A,{children:[e.jsx(q,{children:a}),e.jsx("p",{className:"text-sm text-gray-600",children:"Dấu (*) đánh dấu tài sản đã xuất/mượn nhiều lần trong tuần"})]}),e.jsx(O,{children:e.jsxs(Q,{children:[e.jsx(Y,{children:e.jsxs(k,{children:[e.jsx(R,{children:"Phòng"}),e.jsx(R,{children:"Năm"}),e.jsx(R,{children:"Mã TS"})]})}),e.jsx(z,{children:n.length>0?n.map((s,i)=>e.jsxs(k,{children:[e.jsx(y,{className:"font-medium",children:s.room}),e.jsx(y,{children:s.year}),e.jsx(y,{children:s.codes})]},i)):e.jsx(k,{children:e.jsx(y,{colSpan:3,className:"text-center text-gray-500",children:"Không có dữ liệu"})})})]})})]}),tt=({transactions:n,paginatedTransactions:a,totalPages:s,currentPage:i,setCurrentPage:t,filterDisplayText:o})=>e.jsxs(L,{className:"rounded-lg border bg-card text-card-foreground shadow-sm",children:[e.jsxs(A,{children:[e.jsxs(q,{children:["Danh sách tài sản cần lấy (",n.length," bản ghi)"]}),e.jsx("p",{className:"text-sm text-gray-600",children:o})]}),e.jsxs(O,{children:[e.jsxs(Q,{children:[e.jsx(Y,{children:e.jsxs(k,{children:[e.jsx(R,{children:"Phòng"}),e.jsx(R,{children:"Năm TS"}),e.jsx(R,{children:"Mã TS"}),e.jsx(R,{children:"Loại"}),e.jsx(R,{children:"Ngày"}),e.jsx(R,{children:"Buổi"}),e.jsx(R,{children:"Ghi chú"}),e.jsx(R,{children:"CB"})]})}),e.jsx(z,{children:a.length>0?a.map(r=>e.jsxs(k,{children:[e.jsx(y,{className:"font-medium",children:r.room}),e.jsx(y,{children:r.asset_year}),e.jsx(y,{children:r.asset_code}),e.jsx(y,{children:r.transaction_type}),e.jsx(y,{children:_(r.transaction_date)}),e.jsx(y,{children:r.parts_day}),e.jsx(y,{children:r.note}),e.jsx(y,{children:r.staff_code})]},r.id)):e.jsx(k,{children:e.jsx(y,{colSpan:8,className:"text-center text-gray-500",children:"Không có dữ liệu"})})})]}),s>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(w,{variant:"outline",onClick:()=>t(Math.max(1,i-1)),disabled:i===1,children:"Trước"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Trang ",i," trên ",s]}),e.jsx(w,{variant:"outline",onClick:()=>t(Math.min(s,i+1)),disabled:i===s,children:"Tiếp"})]})]})]}),ft=()=>{const{transactions:n,isLoading:a,isExporting:s,showGrouped:i,setShowGrouped:t,filterType:o,setFilterType:r,customFilters:l,setCustomFilters:d,currentPage:h,setCurrentPage:f,resultsRef:g,handleCustomFilter:m,groupedRows:u,paginatedTransactions:p,totalPages:j,exportToPDF:v,getFilterDisplayText:N,dateStrings:b}=Be();return a&&n.length===0?e.jsx(B,{children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})})}):e.jsxs(B,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-green-100 rounded-full",children:e.jsx(Ae,{className:"w-6 h-6 text-green-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Danh sách TS cần lấy"})]})}),e.jsx(Je,{filterType:o,setFilterType:r,customFilters:l,setCustomFilters:d,handleCustomFilter:m,dateStrings:b}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs(w,{onClick:v,disabled:s,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),s?"Đang xuất...":"Xuất PDF"]}),e.jsxs(w,{variant:"outline",onClick:()=>t(!i),className:"text-purple-600 border-purple-600 hover:bg-purple-50",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),i?"Hiện chi tiết":"Hiện DS tổng"]})]}),e.jsx("div",{id:"print-section",ref:g,children:i?e.jsx(et,{groupedRows:u,filterDisplayText:N()}):e.jsx(tt,{transactions:n,paginatedTransactions:p,totalPages:j,currentPage:h,setCurrentPage:f,filterDisplayText:N()})})]}),e.jsx("style",{children:`
        @media print {
          body * { visibility: hidden; }
          #print-section, #print-section * { visibility: visible; }
          #print-section { position: absolute; left: 0; top: 0; width: 100%; }
        }
      `})]})};export{ft as default};
