import{c as A,j as e,L as C,B as v,r,u as S,a as T,b as E}from"./index-DpfqfBid.js";import{P as F,C as H,a as I,b as q,c as D}from"./index-1NCKpGgW.js";import{I as N,A as U,a as M}from"./input-BQM1MWAl.js";import{L as y}from"./label-DTj3kehB.js";import{L as w}from"./lock-BYO1XYqp.js";import{C as B}from"./circle-alert-D7E0CW1m.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=A("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),R=()=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mb-4",children:e.jsx(F,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Đăng nhập"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Truy cập hệ thống quản lý tài sản kho"})]}),V=({credentials:s,setCredentials:t,onSubmit:l,isLoading:a})=>{const n=o=>{const u=o.target.value.toLowerCase().trim();t({...s,username:u})};return e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"username",children:"Tên đăng nhập"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(N,{id:"username",type:"text",placeholder:"Nhập tên đăng nhập",value:s.username,onChange:n,className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"password",children:"Mật khẩu"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(N,{id:"password",type:"password",placeholder:"Nhập mật khẩu",value:s.password,onChange:o=>t({...s,password:o.target.value}),className:"pl-10",required:!0})]})]}),e.jsx("div",{className:"text-right",children:e.jsx(C,{to:"/reset-password",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline",children:"Reset mật khẩu"})}),e.jsx(v,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:a,children:a?"Đang đăng nhập...":"Đăng nhập"})]})},Q=({onTryAnotherAccount:s})=>e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-8 h-8 text-red-600"})}),e.jsx("p",{className:"text-red-600 font-medium",children:"Tài khoản của bạn đã bị khóa. Hãy liên hệ Admin để được mở khóa."}),e.jsx(v,{variant:"outline",onClick:s,className:"w-full",children:"Thử tài khoản khác"})]}),z=(s,t)=>{const[l,a]=r.useState(s);return r.useEffect(()=>{const n=setTimeout(()=>{a(s)},t);return()=>{clearTimeout(n)}},[s,t]),l},Y=()=>{const s=S(),{user:t,login:l,loading:a}=T(),[n,o]=r.useState({username:"",password:""}),[u,i]=r.useState(""),[k,f]=r.useState(!1),[p,d]=r.useState(!1),[g,h]=r.useState(!0),m=z(n.username,500);r.useEffect(()=>{(async()=>{if(!m){p&&x();return}const{isLocked:c,error:b}=await E(m);if(b){console.error("Status check failed:",b);return}c?(i("Tài khoản của bạn đã bị khóa. Hãy liên hệ Admin để được mở khóa."),d(!0),h(!1)):p&&x()})()},[m]),r.useEffect(()=>{!a&&t&&(t.department==="NQ"?s("/daily-report"):s("/asset-entry"))},[t,a,s]);const L=async j=>{j.preventDefault(),f(!0),i(""),d(!1),h(!0);try{const c=await l(n.username.toLowerCase().trim(),n.password);c.error&&(i(c.error),typeof c.error=="string"&&c.error.includes("khóa")&&(d(!0),h(!1)))}catch(c){console.error("💥 Login submit error:",c),i("Đã xảy ra lỗi trong quá trình đăng nhập")}f(!1)},x=()=>{o({username:"",password:""}),h(!0),d(!1),i("")};return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Đang kiểm tra trạng thái đăng nhập..."})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsx(R,{}),e.jsxs(H,{className:"shadow-lg border-0",children:[e.jsx(I,{children:e.jsx(q,{className:"text-xl text-center",children:"Thông tin đăng nhập"})}),e.jsxs(D,{className:"space-y-6",children:[u&&g&&e.jsxs(U,{variant:"destructive",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(M,{children:u})]}),g?e.jsx(V,{credentials:n,setCredentials:o,onSubmit:L,isLoading:k}):e.jsx(Q,{onTryAnotherAccount:x})]})]})]})})};export{Y as default};
