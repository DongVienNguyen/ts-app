import{s as o,v as e,l as n}from"./index-Cfyb-cTT.js";const c=async r=>{try{for(const t of r){if(!e.isValidAssetCode(t.asset_code))throw new Error("Mã tài sản không hợp lệ");if(!e.isValidYear(t.asset_year))throw new Error("Năm tài sản không hợp lệ");if(!e.isValidDate(t.transaction_date))throw new Error("Ngày giao dịch không hợp lệ");t.staff_code=e.sanitizeString(t.staff_code),t.parts_day=e.sanitizeString(t.parts_day),t.room=e.sanitizeString(t.room),t.transaction_type=e.sanitizeString(t.transaction_type),t.note&&(t.note=e.sanitizeString(t.note))}const{data:a,error:s}=await o.from("asset_transactions").insert(r).select();if(s)throw n("ASSET_TRANSACTION_SAVE_ERROR",{error:s.message}),new Error(`Lỗi lưu dữ liệu: ${s.message}`);return a}catch(a){throw n("ASSET_TRANSACTION_SAVE_EXCEPTION",{error:a.message}),a}},g=async(r={})=>{try{let a=o.from("asset_transactions").select("*");if(r.staffCode){if(!e.isValidUsername(r.staffCode))throw new Error("Mã nhân viên không hợp lệ");a=a.eq("staff_code",e.sanitizeString(r.staffCode))}if(r.startDate&&(a=a.gte("transaction_date",r.startDate)),r.endDate&&(a=a.lte("transaction_date",r.endDate)),r.isQlnPgdNextDay&&r.startDate){const i=["CMT8","NS","ĐS","LĐH"].map(d=>`'${d}'`).join(",");a=a.eq("transaction_date",r.startDate).or(`parts_day.eq.Sáng,and(parts_day.eq.Chiều,room.in.(${i}))`)}else r.parts_day&&r.parts_day!=="all"&&(a=a.eq("parts_day",r.parts_day));a=a.order("room",{ascending:!0}).order("asset_year",{ascending:!0}).order("asset_code",{ascending:!0});const{data:s,error:t}=await a;if(t)throw n("ASSET_TRANSACTION_FETCH_ERROR",{error:t.message}),t;return s||[]}catch(a){throw n("ASSET_TRANSACTION_FETCH_EXCEPTION",{error:a.message}),a}};export{g,c as s};
